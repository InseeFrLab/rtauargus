<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Creates a hrc file from microdata — write_hrc • rtauargus</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creates a hrc file from microdata — write_hrc"><meta name="description" content="Creates an hrc file (hierarchy) from several variables in a set of
microdata set.
Crée un fichier hrc (hiérarchie) à partir de plusieurs variables d'un jeu de
microdonnées."><meta property="og:description" content="Creates an hrc file (hierarchy) from several variables in a set of
microdata set.
Crée un fichier hrc (hiérarchie) à partir de plusieurs variables d'un jeu de
microdonnées."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtauargus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rtauargus.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>tabular-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_fr.html">Tau-Argus depuis R - données tabulées</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables.html">Protect several linked tables at once</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables_fr.html">Protéger des tableaux liés</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules.html">Safety rules and Suppress Options</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules_fr.html">Les arguments Safety rules et Suppress</a></li>
    <li><a class="dropdown-item" href="../articles/split_tab_fr.html">Comment poser du secret sur des tableaux à 4 ou 5 dimensions avec `rtauargus`?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>auto-analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata.html">Automatic analysis of metadata</a></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata_fr.html">Analyse automatique des métadonnées</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>micro-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro.html">&amp;tau;-Argus from R - microdata version</a></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro_fr.html">Tau-Argus depuis R - sur microdonnées</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creates a hrc file from microdata</h1>
      <small class="dont-index">Source: <a href="https://github.com/inseefrlab/rtauargus/blob/master/R/hrc.R" class="external-link"><code>R/hrc.R</code></a></small>
      <div class="d-none name"><code>write_hrc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates an hrc file (hierarchy) from several variables in a set of
microdata set.<br>
Crée un fichier hrc (hiérarchie) à partir de plusieurs variables d'un jeu de
microdonnées.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">write_hrc</span><span class="op">(</span></span>
<span>  <span class="va">microdata</span>,</span>
<span>  <span class="va">vars_hrc</span>,</span>
<span>  hierleadstring <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"rtauargus.hierleadstring"</span><span class="op">)</span>,</span>
<span>  hrc_filename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fill_na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"down"</span><span class="op">)</span>,</span>
<span>  compact <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  hierlevels <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-microdata">microdata<a class="anchor" aria-label="anchor" href="#arg-microdata"></a></dt>
<dd><p>data.frame containing the microdata. <br>
( data.frame contenant les microdonnées.)</p></dd>


<dt id="arg-vars-hrc">vars_hrc<a class="anchor" aria-label="anchor" href="#arg-vars-hrc"></a></dt>
<dd><p>vector of variable names
constituting the hierarchy, from the finest to the most aggregated level.<br>
(vecteur des noms des variables
constituant la hiérarchie, du niveau le plus fin au niveau le plus agrégé.)</p></dd>


<dt id="arg-hierleadstring">hierleadstring<a class="anchor" aria-label="anchor" href="#arg-hierleadstring"></a></dt>
<dd><p>character which, repeated n times, indicates that the value is
at n levels deep in the hierarchy. <br>
(caractère qui, répété n fois, indique que la valeur est
à n niveaux de profondeur dans la hiérarchie.)</p></dd>


<dt id="arg-hrc-filename">hrc_filename<a class="anchor" aria-label="anchor" href="#arg-hrc-filename"></a></dt>
<dd><p>name and location of the produced hrc file. If not
filled, a temporary file.<br>
(nom et emplacement du fichier hrc produit. Si non renseigné, un fichier temporaire.)</p></dd>


<dt id="arg-fill-na">fill_na<a class="anchor" aria-label="anchor" href="#arg-fill-na"></a></dt>
<dd><p>fill in any missing values, using an other variable :</p><ul><li><p><code>"up"</code> (default) : hierarchical variable of the level level
immediately above</p></li>
<li><p><code>"down"</code> : hierarchical variable of the level immediately
lower</p></li>
</ul><p><br>
(remplissage d'éventuelles valeurs manquantes, à l'aide d'une
autre variable :</p><ul><li><p><code>"up"</code> (défaut) : variable hiérarchique de niveau
immédiatement supérieur</p></li>
<li><p><code>"down"</code> : variable hiérarchique de niveau immédiatement
inférieur</p></li>
</ul><p>)</p></dd>


<dt id="arg-compact">compact<a class="anchor" aria-label="anchor" href="#arg-compact"></a></dt>
<dd><p>to prune branches repeating a single value to the
lowest level of depth (<code>TRUE</code> by default).<br>
(pour élaguer les branches répétant une unique valeur jusqu'au
plus bas niveau de profondeur (<code>TRUE</code> par défaut).)</p></dd>


<dt id="arg-hierlevels">hierlevels<a class="anchor" aria-label="anchor" href="#arg-hierlevels"></a></dt>
<dd><p>if only one variable is specified in <code>vars_hrc</code>,
allows to generate the hierarchy according to the position of the characters in the
string. For example, <code>hierlevels = "2 3"</code> to build a
hierarchy from a common code.<br>
(si une seule variable est spécifiée dans <code>vars_hrc</code>,
permet de générer la hiérarchie selon la position des caractères dans la
chaîne. Par exemple, <code>hierlevels = "2 3"</code> pour construire une
hiérarchie département-commune à partir d'un code commune.)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The name of the hrc file (useful in the case of a temporary file with
random name).<br>
(Le nom du fichier hrc (utile dans le cas d'un fichier temporaire au
nom aléatoire).)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function reconstructs the variable hierarchy from the levels
present in the data. The variables in <code>vars_hrc</code> must be
<strong>classified from the finest to the most aggregated</strong>.</p>
<p>The relationship between each hierarchical level must be an application (in the
mathematical sense of the term), i.e. each fine level must have a
single corresponding aggregated level. The creation of the hierarchy is
impossible if this condition is not met.</p>
<p>If the name of the output file is not specified, a temporary file is
created. It will be deleted at the end of the session. The path to this file can be
retrieved in the return value of the function.</p>
<p>Missing values in the hierarchical variables will be
imputed beforehand using another hierarchical variable (parameter
<code>fill_na</code>). In ascending strategy (<code>"up"</code>), the variables are
from the most aggregated to the most refined, and vice versa in the
downward strategy (<code>"down"</code>).</p>
<p>The parameter <code>compact</code> allows to create hierarchies with variable
depths. The idea is to cut the branches consisting of a single value
repeated up to the maximum depth (see examples).<br></p>
<p>La fonction reconstitue la hiérarchie des variables à partir des niveaux
présents dans les données. Les variables dans <code>vars_hrc</code> doivent être
<strong>classées de la plus fine à la plus agrégée</strong>.</p>
<p>La relation entre chaque niveau hiérarchique doit être une application (au
sens mathématique du terme), c'est-à-dire que chaque niveau fin doit avoir un
seul et unique niveau agrégé correspondant. La création de la hiérarchie est
impossible si cette condition n'est pas remplie.</p>
<p>Si le nom du fichier en sortie n'est pas spécifié, un fichier temporaire est
créé. Il sera effacé en fin de session. Le chemin vers ce fichier peut être
récupéré dans la valeur de retour de la fonction.</p>
<p>Les valeurs manquantes présentes dans les variables hiérarchiques seront
préalablement imputées à l'aide d'une autre variable hiérarchique (paramètre
<code>fill_na</code>). En stratégie ascendante (<code>"up"</code>), les variables sont
parcourues de la plus agrégée à la plus fine, et inversement en stratégie
descendante (<code>"down"</code>).</p>
<p>Le paramètre <code>compact</code> permet de créer des hiérarchies à profondeurs
variables. L'idée est de couper les branches constituées d'une seule valeur
répétée jusqu'à la profondeur maximale (voir exemples).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Full Hierarchy ............................</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_naf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  A10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AZ"</span>, <span class="st">"BE"</span>, <span class="st">"BE"</span>, <span class="st">"BE"</span>, <span class="st">"BE"</span>, <span class="st">"BE"</span>, <span class="st">"BE"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  A21 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> , <span class="st">"C"</span> , <span class="st">"B"</span> , <span class="st">"C"</span> , <span class="st">"C"</span> , <span class="st">"C"</span> , <span class="st">"B"</span> <span class="op">)</span>,</span></span>
<span class="r-in"><span>  A88 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01"</span>, <span class="st">"10"</span>, <span class="st">"06"</span>, <span class="st">"10"</span>, <span class="st">"12"</span>, <span class="st">"11"</span>, <span class="st">"07"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu">write_hrc</span><span class="op">(</span><span class="va">df_naf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A88"</span>, <span class="st">"A21"</span>, <span class="st">"A10"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="va">tmp_file</span>, pager <span class="op">=</span> <span class="st">"console"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu">write_hrc</span><span class="op">(</span><span class="va">df_naf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A88"</span>, <span class="st">"A10"</span><span class="op">)</span>, hierleadstring <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="va">tmp_file</span>, pager <span class="op">=</span> <span class="st">"console"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Hierarchy with varying depth  ...............</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  niv1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>  , <span class="st">"A"</span>  , <span class="st">"A"</span>  , <span class="st">"B"</span>  , <span class="st">"C"</span>  , <span class="st">"C"</span> <span class="op">)</span>,</span></span>
<span class="r-in"><span>  niv2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span> , <span class="st">"A1"</span> , <span class="st">"A2"</span> ,  <span class="cn">NA</span>  , <span class="st">"C1"</span> , <span class="st">"C2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  niv3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1x"</span>, <span class="st">"A1y"</span>,  <span class="cn">NA</span>  ,  <span class="cn">NA</span>  , <span class="st">"C1"</span> ,  <span class="cn">NA</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu">write_hrc</span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"niv3"</span>, <span class="st">"niv2"</span>, <span class="st">"niv1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>valeurs manquantes imputees pour construire la hierarchie</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="va">tmp_file</span>, pager <span class="op">=</span> <span class="st">"console"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu">write_hrc</span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"niv3"</span>, <span class="st">"niv2"</span>, <span class="st">"niv1"</span><span class="op">)</span>, compact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>valeurs manquantes imputees pour construire la hierarchie</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="va">tmp_file</span>, pager <span class="op">=</span> <span class="st">"console"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pierre-Yves Berrard, Julien Jamme, Nathanaël Rastout, Jeanne Pointet, Félix Beroud, André-Raymond Socard, Wistan Pomel, Clara Baudry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

