<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyse automatique des métadonnées • rtauargus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyse automatique des métadonnées">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Passer au contenu</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Navigation sur le site"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtauargus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Dernière version publiée">1.2.999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Activer la navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rtauargus.html">Prise en main</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Référence</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>tabular-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_fr.html">Tau-Argus depuis R - données tabulées</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables.html">Protect several linked tables at once</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables_fr.html">Protéger des tableaux liés</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules.html">Safety rules and Suppress Options</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules_fr.html">Les arguments Safety rules et Suppress</a></li>
    <li><a class="dropdown-item" href="../articles/split_tab_fr.html">Comment poser du secret sur des tableaux à 4 ou 5 dimensions avec `rtauargus`?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>auto-analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata.html">Automatic analysis of metadata</a></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata_fr.html">Analyse automatique des métadonnées</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>micro-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro.html">&amp;tau;-Argus from R - microdata version</a></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro_fr.html">Tau-Argus depuis R - sur microdonnées</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changements</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Rechercher sur le site" placeholder="Rechercher" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyse automatique des métadonnées</h1>
            <h3 data-toc-skip class="subtitle"><h2>
<br><img src="R_logo_small.png" alt="logo R"><img src="TauBall2_small.png" alt="logo τ-Argus"><br>Package {rtauargus}<br>
</h2></h3>
            
      
      <small class="dont-index">Source : <a href="https://github.com/inseefrlab/rtauargus/blob/master/vignettes/auto_metadata_fr.Rmd" class="external-link"><code>vignettes/auto_metadata_fr.Rmd</code></a></small>
      <div class="d-none name"><code>auto_metadata_fr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Avant de faire appel aux fonctions permettant la pose du secret il
est nécessaire d’analyser les tableaux que l’on souhaite protéger. En
effet,les tableaux diffusés sont différents des tableaux à protéger.
Cela est expliqué en détail au chapitre 3 du <a href="https://inseefrlab.github.io/manuel-protection-tableaux/03_analyser_une_demande.html" class="external-link">Manuel
de protection des tableaux</a>. Cette phase d’analyse des marges
communes entre les différents tableaux peut s’avérer complexe. Ainsi,
des fonctions ont été développées dans <code>rtauargus</code> pour
faciliter ce travail.</p>
</div>
<div class="section level2">
<h2 id="comment-fonctionne-lanalyse-automatique-automatique-des-métadonnées">Comment fonctionne l’analyse automatique automatique des métadonnées
?<a class="anchor" aria-label="anchor" href="#comment-fonctionne-lanalyse-automatique-automatique-des-m%C3%A9tadonn%C3%A9es"></a>
</h2>
<div class="section level3">
<h3 id="création-des-métadonnées">Création des métadonnées <a class="anchor" aria-label="anchor" href="#cr%C3%A9ation-des-m%C3%A9tadonn%C3%A9es"></a>
</h3>
<p>Les métadonnées doivent respecter un format spécifique. Une ligne
représente un tableau et pour chaque tableau il faut préciser :</p>
<ul>
<li>
<code>table_name</code> : le nom du tableau ;</li>
<li>
<code>field</code> : le champ (souvent, zone géographique,
population étudiée, millésime) ;</li>
<li>
<code>hrc_field</code> : s’il existe ou non un lien hiérarchique
entre ce champ et un autre champ. S’il n’y a pas de lien hiérarchique
cette case vaut <code>NA</code>. Si au contraire, un lien hiérarchique
existe, il faut donner un nom à ce lien et réécrire ce même nom dans les
autres tableaux ;</li>
<li>
<code>indicator</code> : le nom de l’indicateur du tableau. Il
s’agit du nom de la variable de ce qui est compté dans chaque cellule du
tableau. Par exemple, si mon tableau présente le chiffre d’affaire des
entreprises ma variable sera sans doute “CA”. Le mieux est de bien
utiliser le nom de la variable tel que décrit dans les données ;</li>
<li>
<code>hrc_indicator</code> : s’il existe ou non un lien hiérarchique
entre cet indicateur et un autre indicateur. S’il n’y a pas de lien
hiérarchique cette case vaut <code>NA</code>. Si au contraire, un lien
hiérarchique existe, il faut donner un nom à ce lien et réécrire ce même
nom dans les autres tableaux ;</li>
<li>
<code>spanning_1</code> : le nom de la première variable de
croisement. On ajoute une colonne par variable de croisement en suivant
le nommage : <code>spanning_1</code>, <code>spanning_2</code>,
<code>spanning_3</code>, etc ;</li>
<li>
<code>hrc_spanning_1</code> : s’il existe ou non un lien
hiérarchique entre cette variable de croisement et une autre variable de
croisement. S’il n’y a pas de lien hiérarchique cette case vaut
<code>NA</code>. Si au contraire, un lien hiérarchique existe, il faut
donner un nom à ce lien et réécrire ce même nom dans les autres
tableaux. On ajoute une colonne par variable de croisement en suivant le
nommage : <code>hrc_spanning_1</code>, <code>hrc_spanning_2</code>,
<code>hrc_spanning_3</code>, etc. N.B. il faut autant de colonnes
<code>spanning_X</code> que de colonnes
<code>hrc_spanning_X</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="input-formaté-templates-eurostat">Input formaté : templates Eurostat<a class="anchor" aria-label="anchor" href="#input-format%C3%A9-templates-eurostat"></a>
</h3>
<p>Lorsque les tableaux à traiter sont des tableaux Eurostat alors on
peut créer automatiquement le fichier de métadonnées à partir du
template des cellules publiées. En effet, pour les publications Eurostat
les INS doivent livrer un template regroupant les cellules publiées.</p>
<p>Pour cela, il faut tout de même bien comprendre chaque colonne du
template. Déterminer pour chacune d’entre elles s’il s’agit de la
variable réponse / indicateur, d’une variable de croisement ou d’un
champ, afin de pouvoir le préciser dans les arguments de la fonction .
Il faut notamment vérifier que le template respecte bien : une variable
de croisement = une colonne du template, et donc un supertotal. En
effet, si une colonne regroupe plusieurs variables de croisement, alors
il faut créer autant de colonnes que de variables de croisement.</p>
</div>
<div class="section level3">
<h3 id="les-arguments-de-analyse_metadata">Les arguments de <code>analyse_metadata</code><a class="anchor" aria-label="anchor" href="#les-arguments-de-analyse_metadata"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">analyse_metadata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (df_metadata, verbose = FALSE) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Les arguments de la fonction sont les suivants :</p>
<ul>
<li>
<code>df_metadata</code> : un dataframe structuré comme précisé dans
la section .</li>
<li>
<code>verbose</code> : une variable de type <code>logical</code>, si
<code>TRUE</code> la fonction retourne une liste avec les différentes
étapes de l’analyse, si <code>FALSE</code> elle retourne juste le
dataframe final avec l’indicatrice de cluster.</li>
</ul>
</div>
<div class="section level3">
<h3 id="les-arguments-de-format_template">Les arguments de <code>format_template</code> <a class="anchor" aria-label="anchor" href="#les-arguments-de-format_template"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">format_template</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (data, indicator_column, spanning_var_tot, field_columns) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Les arguments de la fonction sont les suivants :</p>
<ul>
<li>
<code>data</code> : dataframe du template Eurostat contenant toutes
les cellules publiées.</li>
<li>
<code>indicator_column</code> : nom de la colonne dans laquelle se
trouvent les indicateurs.</li>
<li>
<code>spanning_var_tot</code> : liste nommée des variables de
croisements et de leurs totaux.</li>
<li>
<code>field_columns</code> : vecteur de toutes les colonnes
représentant des champs (ex : millésime).</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="exemples">Exemples<a class="anchor" aria-label="anchor" href="#exemples"></a>
</h2>
<div class="section level3">
<h3 id="cas-où-les-métadonnées-en-input-sont-au-bon-format">Cas où les métadonnées en input sont au bon format<a class="anchor" aria-label="anchor" href="#cas-o%C3%B9-les-m%C3%A9tadonn%C3%A9es-en-input-sont-au-bon-format"></a>
</h3>
<p>Dans cet exemple on part d’un fichier de métadonnées présentant 12
tableaux à publier sur les chiffres d’affaires de ventes de pizzas et de
salades.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    12 obs. of  9 variables:</span></span>
<span><span class="co">##  $ table_name    : chr  "T1" "T2" "T3" "T4" ...</span></span>
<span><span class="co">##  $ field         : chr  "france_entreprises_2023" "france_entreprises_2023" "france_entreprises_2023" "france_entreprises_2023" ...</span></span>
<span><span class="co">##  $ hrc_field     : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ indicator     : chr  "to_pizza" "to_pizza" "to_pizza" "to_pizza" ...</span></span>
<span><span class="co">##  $ hrc_indicator : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ spanning_1    : chr  "nuts2" "nuts3" "a10" "a10" ...</span></span>
<span><span class="co">##  $ hrc_spanning_1: chr  "hrc_nuts" "hrc_nuts" "hrc_naf" "hrc_naf" ...</span></span>
<span><span class="co">##  $ spanning_2    : chr  "size" "size" "nuts2" "nuts3" ...</span></span>
<span><span class="co">##  $ hrc_spanning_2: chr  NA NA "hrc_nuts" "hrc_nuts" ...</span></span></code></pre>
<p>Exemple de code :</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyse complète, avec les étapes</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output simplifié, uniquement le dataframe avec l'indicatrice de cluster</span></span>
<span><span class="va">cluster_id_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>On obtient un dataframe nous présentant la façon de traiter les
tableaux pour la pose du secret.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_id_dataframe</span></span></code></pre></div>
<pre><code><span><span class="co">##                               cluster  table_name                   field indicator spanning_1 spanning_2    spanning_3 hrc_spanning_1 hrc_spanning_2</span></span>
<span><span class="co">## 1 france_entreprises_2023.hrc_lettuce  T10.T12.T8 france_entreprises_2023   LETTUCE    HRC_NAF         cj HRC_LETTUCE^h        hrc_naf           &lt;NA&gt;</span></span>
<span><span class="co">## 2 france_entreprises_2023.hrc_lettuce   T11.T7.T9 france_entreprises_2023   LETTUCE    HRC_NAF       size HRC_LETTUCE^h        hrc_naf           &lt;NA&gt;</span></span>
<span><span class="co">## 3    france_entreprises_2023.to_pizza       T1.T2 france_entreprises_2023  to_pizza   HRC_NUTS       size          &lt;NA&gt;       hrc_nuts           &lt;NA&gt;</span></span>
<span><span class="co">## 4    france_entreprises_2023.to_pizza T3.T4.T5.T6 france_entreprises_2023  to_pizza    HRC_NAF   HRC_NUTS          &lt;NA&gt;        hrc_naf       hrc_nuts</span></span>
<span><span class="co">##   hrc_spanning_3</span></span>
<span><span class="co">## 1    hrc_lettuce</span></span>
<span><span class="co">## 2    hrc_lettuce</span></span>
<span><span class="co">## 3           &lt;NA&gt;</span></span>
<span><span class="co">## 4           &lt;NA&gt;</span></span></code></pre>
<p>Pour les 12 tableaux à publier il suffit de protéger 4 tableaux. Ces
tableaux sont repartis dans deux clusters différents. Il faudra donc
faire appel deux fois à <code><a href="../reference/tab_multi_manager.html">tab_multi_manager()</a></code>. On remarque
une nouvelle variable de croisement <code>HRC_LETTUCE^h</code>. Il
s’agit d’une variable qui prend pour modalités <code>batavia</code> et
<code>arugula</code> et a pour total <code>lettuce</code>. L’indicateur
<code>LETTUCE</code> renvoie ici au “turnover” (to) ou “chiffre
d’affaires” de la vente de salades. Par exemple, le tableau
<code>T10.T12.T8</code> présente le chiffre d’affaires de la vente de
salades en fonction de l’activité et de la catégorie de l’entreprise
ainsi que du type de salade.</p>
<p>Si l’on souhaite avoir plus d’informations sur l’analyse de la
demande, on peut spécifier l’argument <code>verbose = TRUE</code>.
Ainsi, l’objet renvoyé par la fonction est une liste des différentes
étapes de l’analyse.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">detailed_analysis</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "identify_hrc"        "info_var"            "split_in_clusters"   "create_edges"        "grp_tab_names"       "grp_tab_in_clusters" "tab_to_treat"       </span></span>
<span><span class="co">## [8] "df_tab_to_treat"</span></span></code></pre>
<p>On retrouve le dataframe avec l’indicatrice du cluster
<code>df_tab_to_treat</code>. On a le même résultat mais en format liste
: chaque élément de la sous-liste <code>tab_to_treat</code> est un
cluster indépendant. Les autres éléments de la liste sont les étapes de
l’analyse.</p>
</div>
<div class="section level3">
<h3 id="cas-où-linput-est-un-template-eurostat">Cas où l’input est un template Eurostat<a class="anchor" aria-label="anchor" href="#cas-o%C3%B9-linput-est-un-template-eurostat"></a>
</h3>
<p>La fonction <code><a href="../reference/format_template.html">format_template()</a></code> permet de créer les
métadonnées à mettre en input de <code><a href="../reference/analyse_metadata.html">analyse_metadata()</a></code> à
partir du template Eurostat des cellules publiées.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">enterprise_template</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">enterprise_template</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    3168 obs. of  5 variables:</span></span>
<span><span class="co">##  $ TIME_PERIOD: int  2022 2022 2022 2022 2022 2022 2022 2022 2022 2022 ...</span></span>
<span><span class="co">##  $ INDICATOR  : chr  "SAL" "SAL" "SAL" "SAL" ...</span></span>
<span><span class="co">##  $ ACTIVITY   : chr  "B" "B" "B" "B" ...</span></span>
<span><span class="co">##  $ NUMBER_EMPL: chr  "E0" "E1T4" "E5T9" "EGE10" ...</span></span>
<span><span class="co">##  $ LEGAL_FORM : chr  "_T" "_T" "_T" "_T" ...</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template_formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_template.html">format_template</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">enterprise_template</span>,</span>
<span>  indicator_column <span class="op">=</span> <span class="st">"INDICATOR"</span>,</span>
<span>  spanning_var_tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    ACTIVITY <span class="op">=</span> <span class="st">"BTSXO_S94"</span>,</span>
<span>    NUMBER_EMPL <span class="op">=</span> <span class="st">"_T"</span>,</span>
<span>    LEGAL_FORM <span class="op">=</span> <span class="st">"_T"</span><span class="op">)</span>,</span>
<span>  field_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TIME_PERIOD"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">template_formatted</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">##             table_name field indicator spanning_1  spanning_2   hrc_spanning_1    hrc_spanning_2</span></span>
<span><span class="co">## 1 table_2021_SAL_DTH_1  2021   SAL_DTH   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 2 table_2021_SAL_DTH_2  2021   SAL_DTH   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 3     table_2022_SAL_1  2022       SAL   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 4     table_2022_SAL_2  2022       SAL   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 5 table_2022_SAL_DTH_1  2022   SAL_DTH   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 6 table_2022_SAL_DTH_2  2022   SAL_DTH   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span></code></pre>
<p>On voit qu’il y a 6 tableaux à publier.</p>
<p>Remarque : <code><a href="../reference/format_template.html">format_template()</a></code> ne construit pas la colonne
<code>hrc_indicator</code> car les informations contenues dans le
template ne permettent pas de la déterminer. Ainsi, il faut la créer
soi-même en fonction des informations que l’on a sur les
indicateurs.</p>
<p>Ici, il n’y a pas de lien hiérarchique entre <code>SAL</code>
(effectifs salariés des entreprises actives) et <code>SAL_DTH</code>
(effectifs salariés dans les décès).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cas où il n'y a aucune hiérarchie sur les indicateurs</span></span>
<span><span class="va">metadata_template</span> <span class="op">&lt;-</span> <span class="va">template_formatted</span><span class="op">$</span><span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hrc_indicator <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">table_name</span>,<span class="va">field</span>,<span class="va">indicator</span>,<span class="va">hrc_indicator</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata_template</span></span></code></pre></div>
<pre><code><span><span class="co">##             table_name field indicator hrc_indicator spanning_1  spanning_2   hrc_spanning_1    hrc_spanning_2</span></span>
<span><span class="co">## 1 table_2021_SAL_DTH_1  2021   SAL_DTH            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 2 table_2021_SAL_DTH_2  2021   SAL_DTH            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 3     table_2022_SAL_1  2022       SAL            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 4     table_2022_SAL_2  2022       SAL            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 5 table_2022_SAL_DTH_1  2022   SAL_DTH            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 6 table_2022_SAL_DTH_2  2022   SAL_DTH            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span></code></pre>
<p>Ensuite, on utilise ce dataframe en input de la fonction
d’analyse.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyse complète, avec les étapes</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_template</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in check_column_names(df_metadata): Error: The dataframe is missing one or more required columns: table_name, field, hrc_field, indicator, hrc_indicator.</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Output simplifié, uniquement le dataframe avec l'indicatrice de cluster</span></span>
<span><span class="va">cluster_id_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_template</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in check_column_names(df_metadata): Error: The dataframe is missing one or more required columns: table_name, field, hrc_field, indicator, hrc_indicator.</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualisation du résultat de l'analyse</span></span>
<span><span class="va">cluster_id_dataframe</span></span></code></pre></div>
<pre><code><span><span class="co">##                               cluster  table_name                   field indicator spanning_1 spanning_2    spanning_3 hrc_spanning_1 hrc_spanning_2</span></span>
<span><span class="co">## 1 france_entreprises_2023.hrc_lettuce  T10.T12.T8 france_entreprises_2023   LETTUCE    HRC_NAF         cj HRC_LETTUCE^h        hrc_naf           &lt;NA&gt;</span></span>
<span><span class="co">## 2 france_entreprises_2023.hrc_lettuce   T11.T7.T9 france_entreprises_2023   LETTUCE    HRC_NAF       size HRC_LETTUCE^h        hrc_naf           &lt;NA&gt;</span></span>
<span><span class="co">## 3    france_entreprises_2023.to_pizza       T1.T2 france_entreprises_2023  to_pizza   HRC_NUTS       size          &lt;NA&gt;       hrc_nuts           &lt;NA&gt;</span></span>
<span><span class="co">## 4    france_entreprises_2023.to_pizza T3.T4.T5.T6 france_entreprises_2023  to_pizza    HRC_NAF   HRC_NUTS          &lt;NA&gt;        hrc_naf       hrc_nuts</span></span>
<span><span class="co">##   hrc_spanning_3</span></span>
<span><span class="co">## 1    hrc_lettuce</span></span>
<span><span class="co">## 2    hrc_lettuce</span></span>
<span><span class="co">## 3           &lt;NA&gt;</span></span>
<span><span class="co">## 4           &lt;NA&gt;</span></span></code></pre>
<p>Finalement, il y a 6 tableaux à traiter dans 3 clusters différents.
Autrement dit, il faudra faire trois fois appel à
<code><a href="../reference/tab_multi_manager.html">tab_multi_manager()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="pour-aller-plus-loin-visualiser-les-inclusions">Pour aller plus loin : visualiser les inclusions<a class="anchor" aria-label="anchor" href="#pour-aller-plus-loin-visualiser-les-inclusions"></a>
</h2>
<p>L’étape <code>create_edges</code> de l’analyse des métadonnées
identifie les tableaux inclus dans d’autres tableaux. Par exemple, XXXXX
est inclus dans XXXXX. Le code suivant permet de visualiser ces
inclusions à l’aide de graphes afin de mieux comprendre la procédure
d’analyse.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attachement du package : 'igraph'</span></span></code></pre>
<pre><code><span><span class="co">## Les objets suivants sont masqués depuis 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     as_data_frame, groups, union</span></span></code></pre>
<pre><code><span><span class="co">## L'objet suivant est masqué depuis 'package:testthat':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     compare</span></span></code></pre>
<pre><code><span><span class="co">## Les objets suivants sont masqués depuis 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     decompose, spectrum</span></span></code></pre>
<pre><code><span><span class="co">## L'objet suivant est masqué depuis 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     union</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph_links_tab</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_desc_links</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list_desc_links</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">ss_dem</span>,<span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">ss_dem</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ss_dem</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html" class="external-link">visNetwork</a></span><span class="op">(</span>nodes <span class="op">=</span> <span class="va">nodes</span>, edges <span class="op">=</span> <span class="va">ss_dem</span>, main <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visIgraphLayout.html" class="external-link">visIgraphLayout</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html" class="external-link">visEdges</a></span><span class="op">(</span>shadow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 arrows <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">TRUE</span>, scaleFactor <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, highlight <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visOptions.html" class="external-link">visOptions</a></span><span class="op">(</span>highlightNearest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">T</span>, hover <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                   nodesIdSelection <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graph_links_tab</span><span class="op">(</span><span class="va">detailed_analysis</span><span class="op">$</span><span class="va">create_edges</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $france_entreprises_2023.hrc_lettuce</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $france_entreprises_2023.to_pizza</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table des matières"><h2>Sur cette page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Développé par Pierre-Yves Berrard, Julien Jamme, Nathanaël Rastout, Jeanne Pointet, Félix Beroud, André-Raymond Socard, Wistan Pomel, Clara Baudry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site créé avec <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
