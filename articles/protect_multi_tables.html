<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rtauargus">
<title>Protect several linked tables at once • rtauargus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Protect several linked tables at once">
<meta property="og:description" content="rtauargus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rtauargus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/rtauargus.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/options_safety_rules.html">Safety rules and Suppress Options</a>
    <a class="dropdown-item" href="../articles/protect_multi_tables.html">Protect several linked tables at once</a>
    <a class="dropdown-item" href="../articles/rtauargus_micro.html">&amp;tau;-Argus from R</a>
    <a class="dropdown-item" href="../articles/rtauargus_micro_fr.html">&amp;tau;-Argus depuis R</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="protect_multi_tables_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Protect several linked tables at once</h1>
            <h3 data-toc-skip class="subtitle"><h2>
<img src="R_logo_small.png" alt="logo R"><img src="TauBall2_small.png" alt="logo τ-Argus"><br>Package {rtauargus}
</h2></h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inseefrlab/rtauargus/blob/HEAD/vignettes/protect_multi_tables.Rmd" class="external-link"><code>vignettes/protect_multi_tables.Rmd</code></a></small>
      <div class="d-none name"><code>protect_multi_tables.Rmd</code></div>
    </div>

    
    
<!--
  NE JAMAIS MODIFIER DIRECTEMENT `rtauargus.Rmd`
  MODIFIER `rtauargus.Rmd.orig` ET EXECUTER `precompilation.R`
  Voir : https://ropensci.org/technotes/2019/12/08/precompute-vignettes
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In <code>rtauargus</code> package, it is now possible to protect a set of linked tables at once. The function to do this is called <code><a href="../reference/tab_multi_manager.html">tab_multi_manager()</a></code>. The very simple algorithm implemented to handle the protection doesn’t depend on the number of tables. Hence, the function can theoretically deal with an indefinite number of tables. Of course, the practical use is limited by the power of the computer. However, we are confident on the ability of the function to treat the most cases. We are interested in cases that you would encounter and the function can’t handle.</p>
<p>A link between two (or more) tables describes the common cells of the tables, that is the cells appearing in them. The function can handle all types of links between tables:</p>
<ul>
<li>margin links: when two tables share one (or more) variables;</li>
<li>links between the response variables, when exists some equations connecting the variables;</li>
<li>non-nested hierarchies: when an explanatory variable is broken down into two (or more) non-nested hierarchies.</li>
</ul>
<p>Actually, the last two types can be handled as the first one. The challenge for the user is to properly define the set of the tables. Once the set is correctly defined, the function takes care of everything.</p>
<p>Firstly, the vignette will present how the function works, secondly, the parameters are quickly described. In the third part, some examples are developped to show how to use it in diverse situations.</p>
<div class="section level3">
<h3 id="how-does-tab_multi_manager-handle-the-protection-of-a-set-of-linked-tables">How does <code>tab_multi_manager()</code> handle the protection of a set of linked tables ?<a class="anchor" aria-label="anchor" href="#how-does-tab_multi_manager-handle-the-protection-of-a-set-of-linked-tables"></a>
</h3>
<p>Firstly, the function merges all the tables of the set. In the resulted table, boolean variables are added to mention whether a cell owns to a given table of the set. So, there are as many boolean variables as the number of tables in the set. The merged table is a very effective way to quickly detect the common cells. Thus, the report of the suppressions is automatic.</p>
<p>The protection process is sequential: one table at a time. To handle the protection of all the tables and not to forget one table or some links, the implemented algorithm works with two lists:</p>
<ul>
<li>
<code>todolist</code>: list of tables which have to be protected;</li>
<li>
<code>remainlist</code>: list of original tables which haven’t yet been protected at all.</li>
</ul>
<p>Both lists are initialized as follows:</p>
<ul>
<li>
<code>todolist</code> = first table in the original list;</li>
<li>
<code>remainlist</code> = all the original tables except the firs one.</li>
</ul>
<p>Then, the algorithm proceeds as shown in the following figure:</p>
<p><img src="multi_tab_schema.png" alt="How tab_multi_manager's algorithm works" width="600" height="500"></p>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>The function returns the original list of tables with some other variables which are boolean variables (TRUE if the cell has to be masked, otherwise FALSE), describing all steps of the suppression process. Each step takes the previous one into account and the last variable indicates the final step. Final status of cell is easily computable with this last variable and the primary suppression status previously computed by the user.</p>
<p>In addition, the function writes all τ-Argus files created during the process. At the end, only the last process for each table is available in the chosen directory. A journal (<code>journal.txt</code>) is also provided. It describes each step of the suppression process: Which table is being protected, how many new common cells have been hit by secondary suppression. At the end of the process, it provides a description of all common cells that have been hit, mentionning the iteration of when each has been hit.</p>
</div>
<div class="section level3">
<h3 id="some-details-on-the-parameters-of-tab_multi_manager">Some details on the parameters of <code>tab_multi_manager()</code><a class="anchor" aria-label="anchor" href="#some-details-on-the-parameters-of-tab_multi_manager"></a>
</h3>
<ul>
<li><p><strong>dir_name</strong> the directory that will contain all the created files, if non existing it will be created. example : dir_names = “my_directory”</p></li>
<li><p><strong>hrc</strong> A named vector specifying the path to the hrc file for each hierarchical variables. example : c(ACTIVITY = “path_to_file/act.hrc”, NUTS = “path_to_file/nuts.hrc” )</p></li>
<li>
<p><strong>alt_hrc</strong> A named list useful for dealing with non-nested hierachies. The names of the list are the names of the tables when alternative (non-nested in general) hierarchies. example : If T1 and T2 have one explanatory variable, called ACTIVITY, and the same response variable, but the <code>ACTIVITY</code> variable has not the same hierarchy in the two tables. Let’s assume that the hierarchies (act1.hrc and act2.hrc) are not nested. In that case, we write the two arguments as follows:</p>
<ul>
<li>hrc = c(ACTIVITY = “path_to_file/act_1.hrc”): By default, this hierarchy will be used.</li>
<li>alt_hrc = list(T2 = c(ACTIVITY = “path_to_file/act_2.hrc”)): In the table T2, the alternative hierarchy will be used.</li>
</ul>
</li>
<li><p><strong>totcode</strong> The code for total for each explanatory variables. It is recommanded to use the same totcode for each variables. If for example the code is “Total” for all variables. This syntax is allowed : totcode = “Total”</p></li>
</ul>
<p>Otherwise the expected input is a list specifying the totcode for each explanatory vars. For example : totcode = list(ACTIVITY = “Total”, NUTS = “FR”, SIZE =“Ensemble”, CJ = “Total”) Default : “Total”</p>
<p>Warning : If the totals are not in the table, they will be computed by Tau-Argus, but they won’t be eligible for primary suppression. We, then, advise users to provide totals in their tables.</p>
<ul>
<li><p><strong>alt_totcode</strong> A named list for alternative total codes. See <code>alt_hrc</code> for use.</p></li>
<li><p><strong>value</strong> The colname of the response variable in the tables, it MUST be the same name for each tables. For example : value = “turnover” Default : “value”</p></li>
<li><p><strong>frequency</strong> The colname of the frequency variable in the tables, it MUST be the same name for each tables. For example : freq = “frequency” Default : “freq”</p></li>
<li><p><strong>secret_var</strong> The name of the boolean variable specifying primary suppression in the tables, it MUST be the same name for each tables. For example : secret_var = “is_secret_prim” Default : “is_secret_prim”</p></li>
<li><p><strong>suppress</strong> The algorithm required to perform secondary suppression, explained in the safety_rules vignette. If Modular approach is chosen, after the first iteration on a given table, the singleton, multi-singleton and minFreq options are deactivated. default : MOD(1,5,1,0,0)"</p></li>
<li><p><strong>ip_start</strong> The manual safety range for the first iteration on a table (integer) default : 10</p></li>
<li><p><strong>ip_end</strong> The manual safety range for the second iteration on a table (integer) default : 0</p></li>
<li><p><strong>num_iter_max</strong> This parameter is here to ensure the fact that the function will stop. default : 10</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="some-examples">Some examples<a class="anchor" aria-label="anchor" href="#some-examples"></a>
</h2>
<p>Let’s specify the location of the TauArgus.exe file in our computer:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  rtauargus.tauargus_exe <span class="op">=</span></span>
<span>    <span class="st">"Y:/Logiciels/TauArgus/TauArgus4.2.2b1/TauArgus.exe"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="about-protecting-4-linked-tables-at-once">About protecting 4 linked tables at once<a class="anchor" aria-label="anchor" href="#about-protecting-4-linked-tables-at-once"></a>
</h3>
<p>In the following example we are going to protect a set of 4 linked tables sharing the same response variable, that is turnover.</p>
<div class="section level4">
<h4 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"turnover_act_size"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"turnover_act_cj"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span> <span class="op">(</span><span class="st">"turnover_nuts_size"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"turnover_nuts_cj"</span><span class="op">)</span></span></code></pre></div>
<p>ACTIVITY X SIZE named turnover_act_size ACTIVITY X CJ named turnover_act_cj NUTS X SIZE named turnover_nuts_size NUTS X CJ turnover_nuts_cj</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">turnover_act_size</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [414 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ ACTIVITY: chr [1:414] "AZ" "BE" "FZ" "GI" ...</span></span>
<span><span class="co">#&gt;  $ SIZE    : chr [1:414] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;  $ N_OBS   : int [1:414] 405 12878 28043 62053 8135 8140 11961 41359 26686 25108 ...</span></span>
<span><span class="co">#&gt;  $ TOT     : num [1:414] 44475 24827613 8907311 26962063 8584917 ...</span></span>
<span><span class="co">#&gt;  $ MAX     : num [1:414] 6212 1442029 1065833 3084242 3957364 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">turnover_nuts_cj</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [452 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ NUTS : chr [1:452] "FR10" "FR21" "FR22" "FR23" ...</span></span>
<span><span class="co">#&gt;  $ CJ   : chr [1:452] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;  $ N_OBS: int [1:452] 38462 6769 4561 5090 8611 7811 5643 10411 8179 5163 ...</span></span>
<span><span class="co">#&gt;  $ TOT  : num [1:452] 33026385 2947560 1917663 3701935 5089279 ...</span></span>
<span><span class="co">#&gt;  $ MAX  : num [1:452] 3084242 544763 651848 298134 1165019 ...</span></span></code></pre></div>
<p>The first step is to create a list containing our four tables, it is advised to give a name to each tables. By doing so it will be easier to tack secondary suppression.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_data_4_tabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  act_size <span class="op">=</span> <span class="va">turnover_act_size</span>,</span>
<span>  act_cj <span class="op">=</span> <span class="va">turnover_act_cj</span>,</span>
<span>  nuts_size <span class="op">=</span> <span class="va">turnover_nuts_size</span>,</span>
<span>  nuts_cj <span class="op">=</span> <span class="va">turnover_nuts_cj</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">list_data_4_tabs</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ act_size : tibble [414 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ ACTIVITY: chr [1:414] "AZ" "BE" "FZ" "GI" ...</span></span>
<span><span class="co">#&gt;   ..$ SIZE    : chr [1:414] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS   : int [1:414] 405 12878 28043 62053 8135 8140 11961 41359 26686 25108 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT     : num [1:414] 44475 24827613 8907311 26962063 8584917 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX     : num [1:414] 6212 1442029 1065833 3084242 3957364 ...</span></span>
<span><span class="co">#&gt;  $ act_cj   : tibble [406 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ ACTIVITY: chr [1:406] "AZ" "BE" "FZ" "GI" ...</span></span>
<span><span class="co">#&gt;   ..$ CJ      : chr [1:406] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS   : int [1:406] 405 12878 28043 62053 8135 8140 11961 41359 26686 25108 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT     : num [1:406] 44475 24827613 8907311 26962063 8584917 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX     : num [1:406] 6212 1442029 1065833 3084242 3957364 ...</span></span>
<span><span class="co">#&gt;  $ nuts_size: tibble [460 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ NUTS : chr [1:460] "FR10" "FR21" "FR22" "FR23" ...</span></span>
<span><span class="co">#&gt;   ..$ SIZE : chr [1:460] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS: int [1:460] 38462 6769 4561 5090 8611 7811 5643 10411 8179 5163 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT  : num [1:460] 33026385 2947560 1917663 3701935 5089279 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX  : num [1:460] 3084242 544763 651848 298134 1165019 ...</span></span>
<span><span class="co">#&gt;  $ nuts_cj  : tibble [452 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ NUTS : chr [1:452] "FR10" "FR21" "FR22" "FR23" ...</span></span>
<span><span class="co">#&gt;   ..$ CJ   : chr [1:452] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS: int [1:452] 38462 6769 4561 5090 8611 7811 5643 10411 8179 5163 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT  : num [1:452] 33026385 2947560 1917663 3701935 5089279 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX  : num [1:452] 3084242 544763 651848 298134 1165019 ...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="applying-primary-suppression-rules">Applying primary suppression rules<a class="anchor" aria-label="anchor" href="#applying-primary-suppression-rules"></a>
</h4>
<p>Then we need to apply the primary suppression for each table. Here we apply 2 rules : The dominance rule NK(1,85) and the frequency rule with a threshold set to 3.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_data_4_tabs</span> <span class="op">&lt;-</span> <span class="va">list_data_4_tabs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          is_secret_freq <span class="op">=</span> <span class="va">N_OBS</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">N_OBS</span> <span class="op">&lt;</span> <span class="fl">3</span>,</span>
<span>          is_secret_dom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">MAX</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">FALSE</span>, <span class="va">MAX</span><span class="op">/</span><span class="va">TOT</span><span class="op">&gt;</span><span class="fl">0.85</span><span class="op">)</span>,</span>
<span>          is_secret_prim <span class="op">=</span> <span class="va">is_secret_freq</span> <span class="op">|</span> <span class="va">is_secret_dom</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">list_data_4_tabs</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ act_size : tibble [414 x 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ ACTIVITY      : chr [1:414] "AZ" "BE" "FZ" "GI" ...</span></span>
<span><span class="co">#&gt;   ..$ SIZE          : chr [1:414] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS         : int [1:414] 405 12878 28043 62053 8135 8140 11961 41359 26686 25108 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT           : num [1:414] 44475 24827613 8907311 26962063 8584917 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX           : num [1:414] 6212 1442029 1065833 3084242 3957364 ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_freq: logi [1:414] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_dom : logi [1:414] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_prim: logi [1:414] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ act_cj   : tibble [406 x 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ ACTIVITY      : chr [1:406] "AZ" "BE" "FZ" "GI" ...</span></span>
<span><span class="co">#&gt;   ..$ CJ            : chr [1:406] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS         : int [1:406] 405 12878 28043 62053 8135 8140 11961 41359 26686 25108 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT           : num [1:406] 44475 24827613 8907311 26962063 8584917 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX           : num [1:406] 6212 1442029 1065833 3084242 3957364 ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_freq: logi [1:406] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_dom : logi [1:406] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_prim: logi [1:406] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ nuts_size: tibble [460 x 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ NUTS          : chr [1:460] "FR10" "FR21" "FR22" "FR23" ...</span></span>
<span><span class="co">#&gt;   ..$ SIZE          : chr [1:460] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS         : int [1:460] 38462 6769 4561 5090 8611 7811 5643 10411 8179 5163 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT           : num [1:460] 33026385 2947560 1917663 3701935 5089279 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX           : num [1:460] 3084242 544763 651848 298134 1165019 ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_freq: logi [1:460] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_dom : logi [1:460] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_prim: logi [1:460] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ nuts_cj  : tibble [452 x 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ NUTS          : chr [1:452] "FR10" "FR21" "FR22" "FR23" ...</span></span>
<span><span class="co">#&gt;   ..$ CJ            : chr [1:452] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;   ..$ N_OBS         : int [1:452] 38462 6769 4561 5090 8611 7811 5643 10411 8179 5163 ...</span></span>
<span><span class="co">#&gt;   ..$ TOT           : num [1:452] 33026385 2947560 1917663 3701935 5089279 ...</span></span>
<span><span class="co">#&gt;   ..$ MAX           : num [1:452] 3084242 544763 651848 298134 1165019 ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_freq: logi [1:452] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_dom : logi [1:452] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ is_secret_prim: logi [1:452] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
<p>Three variables have been added to each table. Only the last one will be used during the protection process. The two others will be useful to state the final status of the cells.</p>
</div>
<div class="section level4">
<h4 id="preparing-the-list-of-explanatory-variables">Preparing the list of explanatory variables<a class="anchor" aria-label="anchor" href="#preparing-the-list-of-explanatory-variables"></a>
</h4>
<p>Then we are going to create the list of explanatory variables of the tables. In our case, the explanatory variables are the 2 first columns of each table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nom_var_list</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="va">list_data_4_tabs</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nom_var_list</span></span>
<span><span class="co">#&gt; $act_size</span></span>
<span><span class="co">#&gt; [1] "ACTIVITY" "SIZE"    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $act_cj</span></span>
<span><span class="co">#&gt; [1] "ACTIVITY" "CJ"      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nuts_size</span></span>
<span><span class="co">#&gt; [1] "NUTS" "SIZE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nuts_cj</span></span>
<span><span class="co">#&gt; [1] "NUTS" "CJ"</span></span></code></pre></div>
<p>The names of the list have to be the names of the corresponding tables in the <code>list_tables</code> argument.</p>
</div>
<div class="section level4">
<h4 id="preparing-the-list-of-total-codes">Preparing the list of total codes<a class="anchor" aria-label="anchor" href="#preparing-the-list-of-total-codes"></a>
</h4>
<p>The labels used to mention the total for each variable have to declared by the user, in a nmaed list. However, when all of the variables have the same label to refer to the total, the information can be mentionned as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total_codes</span> <span class="op">&lt;-</span> <span class="st">"Total"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="making-the-hierarchical-files">Making the hierarchical files<a class="anchor" aria-label="anchor" href="#making-the-hierarchical-files"></a>
</h4>
<p><code>ACTIVITY</code> and <code>NUTS</code> are two hierarchical variables. We use a correspondance table for each of them to create the <code>.hrc</code> files that tau-Argus need.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">activity_corr_table</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nuts23_fr_corr_table</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrc_file_activity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_hrc2.html">write_hrc2</a></span><span class="op">(</span></span>
<span>  corr_table <span class="op">=</span> <span class="va">activity_corr_table</span>,</span>
<span>  file_name <span class="op">=</span> <span class="st">"hrc/activity.hrc"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hrc_file_nuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_hrc2.html">write_hrc2</a></span><span class="op">(</span></span>
<span>  corr_table <span class="op">=</span> <span class="va">nuts23_fr_corr_table</span>,</span>
<span>  file_name <span class="op">=</span> <span class="st">"hrc/nuts.hrc"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To mention the names of the hrc files, we create a named vector (or list) as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrc_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  ACTIVITY <span class="op">=</span> <span class="va">hrc_file_activity</span>,</span>
<span>  NUTS <span class="op">=</span> <span class="va">hrc_file_nuts</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The names of the vector have to be the names of the corresponding hierarchical variables.</p>
</div>
<div class="section level4">
<h4 id="running-the-protection-of-all-the-tables-at-once">Running the protection of all the tables at once<a class="anchor" aria-label="anchor" href="#running-the-protection-of-all-the-tables-at-once"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tab_multi_manager.html">tab_multi_manager</a></span><span class="op">(</span></span>
<span>    list_tables <span class="op">=</span> <span class="va">list_data_4_tabs</span>,</span>
<span>    list_explanatory_vars <span class="op">=</span> <span class="va">nom_var_list</span>,</span>
<span>    dir_name <span class="op">=</span> <span class="st">"tauargus_files/ex4"</span>,</span>
<span>    hrc <span class="op">=</span> <span class="va">hrc_files</span>,</span>
<span>    totcode <span class="op">=</span> <span class="va">total_codes</span>,</span>
<span>    value <span class="op">=</span> <span class="st">"TOT"</span>,</span>
<span>    freq <span class="op">=</span> <span class="st">"N_OBS"</span>,</span>
<span>    secret_var <span class="op">=</span> <span class="st">"is_secret_prim"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_cj ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  nuts_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  nuts_cj ---</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="results-1">Results<a class="anchor" aria-label="anchor" href="#results-1"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_with_status</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span><span class="op">~</span><span class="st">"final_suppress"</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          status <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">is_secret_freq</span> <span class="op">~</span> <span class="st">"A"</span>,</span>
<span>            <span class="va">is_secret_dom</span> <span class="op">~</span> <span class="st">"B"</span>,</span>
<span>            <span class="va">final_suppress</span> <span class="op">~</span> <span class="st">"D"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span><span class="st">"V"</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">TOT</span>, <span class="va">N_OBS</span>, <span class="va">status</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">list_with_status</span><span class="op">$</span><span class="va">act_size</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    414 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ ACTIVITY: chr  "01" "01" "02" "02" ...</span></span>
<span><span class="co">#&gt;  $ SIZE    : chr  "Total" "tr1" "Total" "tr1" ...</span></span>
<span><span class="co">#&gt;  $ TOT     : num  853 853 43623 35503 8120 ...</span></span>
<span><span class="co">#&gt;  $ N_OBS   : int  18 18 387 381 6 1 1 4 4 84 ...</span></span>
<span><span class="co">#&gt;  $ status  : chr  "V" "V" "V" "V" ...</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_with_status</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">iwalk</a></span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,<span class="va">name</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>      <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; act_size </span></span>
<span><span class="co">#&gt;   status   n</span></span>
<span><span class="co">#&gt; 1      A  52</span></span>
<span><span class="co">#&gt; 2      B  25</span></span>
<span><span class="co">#&gt; 3      D  83</span></span>
<span><span class="co">#&gt; 4      V 254</span></span>
<span><span class="co">#&gt; act_cj </span></span>
<span><span class="co">#&gt;   status   n</span></span>
<span><span class="co">#&gt; 1      A  35</span></span>
<span><span class="co">#&gt; 2      B  25</span></span>
<span><span class="co">#&gt; 3      D  90</span></span>
<span><span class="co">#&gt; 4      V 256</span></span>
<span><span class="co">#&gt; nuts_size </span></span>
<span><span class="co">#&gt;   status   n</span></span>
<span><span class="co">#&gt; 1      A  55</span></span>
<span><span class="co">#&gt; 2      B  17</span></span>
<span><span class="co">#&gt; 3      D  82</span></span>
<span><span class="co">#&gt; 4      V 306</span></span>
<span><span class="co">#&gt; nuts_cj </span></span>
<span><span class="co">#&gt;   status   n</span></span>
<span><span class="co">#&gt; 1      A  45</span></span>
<span><span class="co">#&gt; 2      B  20</span></span>
<span><span class="co">#&gt; 3      D 101</span></span>
<span><span class="co">#&gt; 4      V 286</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="dealing-with-non-nested-hierarchies">Dealing with non-nested hierarchies<a class="anchor" aria-label="anchor" href="#dealing-with-non-nested-hierarchies"></a>
</h3>
<p>Let’s assume that we’d like to protect the two tables crossing <code>ACTIVITY</code> and <code>SIZE</code> in one hand and <code>ACTIVITY</code> and <code>CJ</code> in the other hand. The <code>ACTIVITY</code> variable is a hierarchical one. Moreover, in that case, we’d like to release a subtotal, called <code>D_TO_M</code>, in addition to those in the <code>activity_corr_table</code>. This subtotal is the sum of the <code>D</code> to <code>M</code> labels of the <code>A21</code> level. As this subtotal can’t be inserted in the main hierarchy, this leads us to a case of non-nested hierarchies.</p>
<p>To confirm the non-nesting of the two hierachies, let’s display an extract of both.</p>
<p>Extract of the main hierarchy:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sdcHierarchies</span><span class="fu">::</span><span class="fu">hier_create</span><span class="op">(</span></span>
<span>  root<span class="op">=</span><span class="st">"Total"</span>,</span>
<span>  nodes <span class="op">=</span> <span class="va">activity_corr_table</span><span class="op">$</span><span class="va">A10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sdcHierarchies</span><span class="fu">::</span><span class="fu">hier_display</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total</span></span>
<span><span class="co">#&gt; +-AZ</span></span>
<span><span class="co">#&gt; +-BE</span></span>
<span><span class="co">#&gt; +-FZ</span></span>
<span><span class="co">#&gt; +-GI</span></span>
<span><span class="co">#&gt; +-JZ</span></span>
<span><span class="co">#&gt; +-KZ</span></span>
<span><span class="co">#&gt; +-LZ</span></span>
<span><span class="co">#&gt; +-MN</span></span>
<span><span class="co">#&gt; +-OQ</span></span>
<span><span class="co">#&gt; \-RU</span></span></code></pre></div>
<p>Extract of the alternative hierarchy:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sdcHierarchies</span><span class="fu">::</span><span class="fu">hier_create</span><span class="op">(</span></span>
<span>  root<span class="op">=</span><span class="st">"D_TO_M"</span>,</span>
<span>  nodes <span class="op">=</span> <span class="va">activity_corr_table_D_TO_M</span><span class="op">$</span><span class="va">A21</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sdcHierarchies</span><span class="fu">::</span><span class="fu">hier_display</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; D_TO_M</span></span>
<span><span class="co">#&gt; +-D</span></span>
<span><span class="co">#&gt; +-E</span></span>
<span><span class="co">#&gt; +-F</span></span>
<span><span class="co">#&gt; +-G</span></span>
<span><span class="co">#&gt; +-H</span></span>
<span><span class="co">#&gt; +-I</span></span>
<span><span class="co">#&gt; +-J</span></span>
<span><span class="co">#&gt; +-K</span></span>
<span><span class="co">#&gt; +-L</span></span>
<span><span class="co">#&gt; \-M</span></span></code></pre></div>
<p>To handle this case, the preferred approach is to create a third table crossing <code>ACTIVITY</code> and <code>SIZE</code> with D to M labels and the subtotal <code>D_TO_M</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover_act_size_D_TO_M</span> <span class="op">&lt;-</span> <span class="va">turnover_act_size</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">ACTIVITY</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">turnover_act_size</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">ACTIVITY</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SIZE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>N_OBS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">N_OBS</span><span class="op">)</span>, TOT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">TOT</span><span class="op">)</span>, MAX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">MAX</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ACTIVITY <span class="op">=</span> <span class="st">"D_TO_M"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">turnover_act_size_D_TO_M</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [44 x 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ ACTIVITY: chr [1:44] "D" "E" "F" "G" ...</span></span>
<span><span class="co">#&gt;  $ SIZE    : chr [1:44] "Total" "Total" "Total" "Total" ...</span></span>
<span><span class="co">#&gt;  $ N_OBS   : int [1:44] 1411 828 28043 41624 6524 13905 8135 8140 11961 28221 ...</span></span>
<span><span class="co">#&gt;  $ TOT     : num [1:44] 2438454 2264393 8907311 18244309 6273334 ...</span></span>
<span><span class="co">#&gt;  $ MAX     : num [1:44] 981369 306905 1065833 765244 3084242 ...</span></span></code></pre></div>
<p>Let’s create the alternative hierarchy file.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">activity_corr_table_D_TO_M</span> <span class="op">&lt;-</span> <span class="va">activity_corr_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">A21</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">A88</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>A10 <span class="op">=</span> <span class="st">"D_TO_M"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hrc_file_activity_D_TO_M</span> <span class="op">&lt;-</span> <span class="va">activity_corr_table_D_TO_M</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/write_hrc2.html">write_hrc2</a></span><span class="op">(</span>file_name <span class="op">=</span> <span class="st">"hrc/activity_D_TO_M"</span><span class="op">)</span></span></code></pre></div>
<p>Then, let’s build the list of tables and apply the primary suppression rules on them.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_data_3_tabs_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  act_size <span class="op">=</span> <span class="va">turnover_act_size</span>,</span>
<span>  act_size_D_TO_M <span class="op">=</span> <span class="va">turnover_act_size_D_TO_M</span>,</span>
<span>  act_cj <span class="op">=</span> <span class="va">turnover_act_cj</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          is_secret_freq <span class="op">=</span> <span class="va">N_OBS</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">N_OBS</span> <span class="op">&lt;</span> <span class="fl">3</span>,</span>
<span>          is_secret_dom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">MAX</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">FALSE</span>, <span class="va">MAX</span><span class="op">/</span><span class="va">TOT</span><span class="op">&gt;</span><span class="fl">0.85</span><span class="op">)</span>,</span>
<span>          is_secret_prim <span class="op">=</span> <span class="va">is_secret_freq</span> <span class="op">|</span> <span class="va">is_secret_dom</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The <code>hrc</code> and <code>alt_hrc</code> arguments are used to mention both hierarchies of the <code>ACTIVITY</code> variable:</p>
<ul>
<li>
<code>hrc</code> is used as int the previous example (a named vector where names are the different hierarchical variables appearingin the tables and values are the files names). Hence, the hierarchy file will be taken in this vector by default.</li>
<li>
<code>alt_hrc</code> is only used to mention the alternative hierarchies. This argument is a named list where names are the tables where the alternative hierarchies have to be applied.</li>
</ul>
<p>The same rationale is used to fill the <code>alt_totcode</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tab_multi_manager.html">tab_multi_manager</a></span><span class="op">(</span></span>
<span>  list_tables <span class="op">=</span> <span class="va">list_data_3_tabs_nn</span>,</span>
<span>  list_explanatory_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    act_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ACTIVITY"</span>, <span class="st">"SIZE"</span><span class="op">)</span>,</span>
<span>    act_size_D_TO_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ACTIVITY"</span>, <span class="st">"SIZE"</span><span class="op">)</span>,</span>
<span>    act_cj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ACTIVITY"</span>, <span class="st">"CJ"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  hrc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ACTIVITY <span class="op">=</span> <span class="va">hrc_file_activity</span><span class="op">)</span>,</span>
<span>  alt_hrc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    act_size_D_TO_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ACTIVITY <span class="op">=</span> <span class="va">hrc_file_activity_D_TO_M</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dir_name <span class="op">=</span> <span class="st">"tauargus_files/ex5"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"TOT"</span>,</span>
<span>  freq <span class="op">=</span> <span class="st">"N_OBS"</span>,</span>
<span>  secret_var <span class="op">=</span> <span class="st">"is_secret_prim"</span>,</span>
<span>  totcode <span class="op">=</span>  <span class="st">"Total"</span>,</span>
<span>  alt_totcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    act_size_D_TO_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ACTIVITY <span class="op">=</span> <span class="st">"D_TO_M"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size_D_TO_M ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_cj ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size_D_TO_M ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_size ---</span></span>
<span><span class="co">#&gt; --- Current table to treat:  act_cj ---</span></span></code></pre></div>
<div class="section level5">
<h5 id="about-this-vignette">About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h5>
<ul>
<li>Authors: <strong><a href="mailto:julien.jamme@insee.fr">Julien Jamme</a></strong> &amp; <strong><a href="mailto:nathanael.rastout@insee.fr">Nathanael Rastout</a></strong>
</li>
<li>Last update: <strong>02/10/2022</strong>
</li>
<li>Version of rtauargus used: <strong>1.1.0</strong>
</li>
<li>Version of τ-Argus used : <strong>TauArgus 4.2.2b1</strong>
</li>
<li>R version used : <strong>4.1.3</strong>
</li>
</ul>
<p style="text-align: right">
<a href="#TOC" title="Back to summary">summary ↑</a>
</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pierre-Yves Berrard, Julien Jamme, Nathanaël Rastout, Jeanne Pointet, Félix Beroud.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
