<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Automatic analysis of metadata • rtauargus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic analysis of metadata">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtauargus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rtauargus.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>tabular-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_fr.html">Tau-Argus depuis R - données tabulées</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables.html">Protect several linked tables at once</a></li>
    <li><a class="dropdown-item" href="../articles/protect_multi_tables_fr.html">Protéger des tableaux liés</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules.html">Safety rules and Suppress Options</a></li>
    <li><a class="dropdown-item" href="../articles/options_safety_rules_fr.html">Les arguments Safety rules et Suppress</a></li>
    <li><a class="dropdown-item" href="../articles/split_tab_fr.html">Comment poser du secret sur des tableaux à 4 ou 5 dimensions avec `rtauargus`?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>auto-analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata.html">Automatic analysis of metadata</a></li>
    <li><a class="dropdown-item" href="../articles/auto_metadata_fr.html">Analyse automatique des métadonnées</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>micro-wise</h6></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro.html">&amp;tau;-Argus from R - microdata version</a></li>
    <li><a class="dropdown-item" href="../articles/rtauargus_micro_fr.html">Tau-Argus depuis R - sur microdonnées</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Automatic analysis of metadata</h1>
            <h3 data-toc-skip class="subtitle"><h2>
<br><img src="R_logo_small.png" alt="logo R"><img src="TauBall2_small.png" alt="logo τ-Argus"><br>Package {rtauargus}<br>
</h2></h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inseefrlab/rtauargus/blob/master/vignettes/auto_metadata.Rmd" class="external-link"><code>vignettes/auto_metadata.Rmd</code></a></small>
      <div class="d-none name"><code>auto_metadata.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Before using the functions that produce safe tables, it is necessary
to analyze the tables that need to be protected. Indeed, the
disseminated tables differ from the tables to be protected. This is
explained in detail in Chapter 3 of the <a href="https://inseefrlab.github.io/manuel-protection-tableaux/03_analyser_une_demande.html" class="external-link">Manuel
de protection des tableaux</a>. This phase of analyzing common margins
between different tables can be complex. Therefore, functions have been
developed in <code>rtauargus</code> to facilitate this work.</p>
</div>
<div class="section level2">
<h2 id="how-does-automatic-metadata-analysis-work">How Does Automatic Metadata Analysis Work?<a class="anchor" aria-label="anchor" href="#how-does-automatic-metadata-analysis-work"></a>
</h2>
<div class="section level3">
<h3 id="creating-metadata">Creating Metadata <a class="anchor" aria-label="anchor" href="#creating-metadata"></a>
</h3>
<p>Metadata must adhere to a specific format. Each line represents a
table, and for each table, the following must be specified:</p>
<ul>
<li>
<code>table_name</code> : the name of the table ;</li>
<li>
<code>field</code> : the field (often, geographical area, studied
population, year of data collection) ;</li>
<li>
<code>hrc_field</code> : whether there is a hierarchical link
between this field and another field. If there is no hierarchical link,
this field should be <code>NA</code>. If a hierarchical link exists, a
name must be given to this link and the same name must be written in the
other tables ;</li>
<li>
<code>indicator</code> : the table’s indicator name. This is the
name of the variable that is counted in each cell of the table. For
example, if my table presents the turnover of companies, my variable
will likely be “Turnover”. It is best to use the variable name as
described in the data;</li>
<li>
<code>hrc_indicator</code> : whether there is a hierarchical link
between this indicator and another indicator. If there is no
hierarchical link, this field should be NA. If a hierarchical link
exists, a name must be given to this link and the same name must be
written in the other tables;</li>
<li>
<code>spanning_1</code> : the name of the first cross-tabulation
(spanning) variable. Additional columns are added for each
cross-tabulation variable, following the naming convention:
<code>spanning_1</code>, <code>spanning_2</code>,
<code>spanning_3</code>, etc ;</li>
<li>
<code>hrc_spanning_1</code> : whether there is a hierarchical link
between this cross-tabulation variable and another cross-tabulation
variable. If there is no hierarchical link, this field should be NA. If
a hierarchical link exists, a name must be given to this link and the
same name must be written in the other tables. Additional columns are
added for each cross-tabulation variable, following the naming
convention: <code>hrc_spanning_1</code>, <code>hrc_spanning_2</code>,
<code>hrc_spanning_3</code>, etc. Note: there must be as many
<code>spanning_X</code> columns as <code>hrc_spanning_X</code>
columns.</li>
</ul>
</div>
<div class="section level3">
<h3 id="formatted-input-eurostat-templates">Formatted Input: Eurostat Templates<a class="anchor" aria-label="anchor" href="#formatted-input-eurostat-templates"></a>
</h3>
<p>When the tables to be processed are Eurostat tables, the metadata
file can be automatically created from the template of the published
cells. Indeed, for Eurostat publications, National Statistical
Institutes (NSIs) must provide a template that groups the published
cells.</p>
<p>To do this, it is essential to understand each column of the
template. Determine for each one whether it is the response
variable/indicator, a cross-tabulation variable, or a field, in order to
specify this in the arguments of the function . It is particularly
important to verify that the template adheres to the following: one
cross-tabulation variable = one column in the template, and thus one
supertotal. Indeed, if a column groups multiple cross-tabulation
variables, then as many columns as cross-tabulation variables must be
created.</p>
</div>
<div class="section level3">
<h3 id="the-arguments-of-analyse_metadata">The Arguments of <code>analyse_metadata</code><a class="anchor" aria-label="anchor" href="#the-arguments-of-analyse_metadata"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">analyse_metadata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (df_metadata, verbose = FALSE) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>The function arguments are as follows:</p>
<ul>
<li>
<code>df_metadata</code>: a dataframe structured as specified in
section .</li>
<li>
<code>verbose</code>: a variable of type <code>logical</code>. If
<code>TRUE</code> he function returns a list with the different steps of
the analysis; if <code>FALSE</code>, it returns only the final dataframe
with the cluster indicator.</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-arguments-of-format_template">The Arguments of <code>format_template</code> <a class="anchor" aria-label="anchor" href="#the-arguments-of-format_template"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">format_template</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (data, indicator_column, spanning_var_tot, field_columns) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Les arguments de la fonction sont les suivants :</p>
<ul>
<li>
<code>data</code> : dataframe du template Eurostat contenant toutes
les cellules publiées.</li>
<li>
<code>indicator_column</code> : nom de la colonne dans laquelle se
trouvent les indicateurs.</li>
<li>
<code>spanning_var_tot</code> : liste nommée des variables de
croisements et de leurs totaux.</li>
<li>
<code>field_columns</code> : vecteur de toutes les colonnes
représentant des champs (ex : millésime).</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="case-where-the-input-is-metadata">Case Where the Input is Metadata<a class="anchor" aria-label="anchor" href="#case-where-the-input-is-metadata"></a>
</h3>
<p>In this example, we start with a metadata file presenting 12 tables
to be published on the turnover of pizza and salad sales.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    12 obs. of  9 variables:</span></span>
<span><span class="co">##  $ table_name    : chr  "T1" "T2" "T3" "T4" ...</span></span>
<span><span class="co">##  $ field         : chr  "france_entreprises_2023" "france_entreprises_2023" "france_entreprises_2023" "france_entreprises_2023" ...</span></span>
<span><span class="co">##  $ hrc_field     : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ indicator     : chr  "to_pizza" "to_pizza" "to_pizza" "to_pizza" ...</span></span>
<span><span class="co">##  $ hrc_indicator : chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ spanning_1    : chr  "nuts2" "nuts3" "a10" "a10" ...</span></span>
<span><span class="co">##  $ hrc_spanning_1: chr  "hrc_nuts" "hrc_nuts" "hrc_naf" "hrc_naf" ...</span></span>
<span><span class="co">##  $ spanning_2    : chr  "size" "size" "nuts2" "nuts3" ...</span></span>
<span><span class="co">##  $ hrc_spanning_2: chr  NA NA "hrc_nuts" "hrc_nuts" ...</span></span></code></pre>
<p>Example code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyse complète, avec les étapes</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output simplifié, uniquement le dataframe avec l'indicatrice de cluster</span></span>
<span><span class="va">cluster_id_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The output is a dataframe showing how to process the tables for
applying the secret.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_id_dataframe</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 4 x 10</span></span>
<span><span class="co">## # Groups:   table_name [4]</span></span>
<span><span class="co">##   cluster        table_name field indicator spanning_1 spanning_2 spanning_3 hrc_spanning_1 hrc_spanning_2 hrc_spanning_3</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;         </span></span>
<span><span class="co">## 1 france_entrep~ T10.T12.T8 fran~ LETTUCE   HRC_NAF    cj         HRC_LETTU~ hrc_naf        &lt;NA&gt;           hrc_lettuce   </span></span>
<span><span class="co">## 2 france_entrep~ T11.T7.T9  fran~ LETTUCE   HRC_NAF    size       HRC_LETTU~ hrc_naf        &lt;NA&gt;           hrc_lettuce   </span></span>
<span><span class="co">## 3 france_entrep~ T1.T2      fran~ to_pizza  HRC_NUTS   size       &lt;NA&gt;       hrc_nuts       &lt;NA&gt;           &lt;NA&gt;          </span></span>
<span><span class="co">## 4 france_entrep~ T3.T4.T5.~ fran~ to_pizza  HRC_NAF    HRC_NUTS   &lt;NA&gt;       hrc_naf        hrc_nuts       &lt;NA&gt;</span></span></code></pre>
<p>For the 12 tables to be published, it is sufficient to protect 4
tables. These tables are distributed across two different clusters.
Therefore, <code><a href="../reference/tab_multi_manager.html">tab_multi_manager()</a></code> needs to be called twice. A
new spanning variable appeared <code>HRC_LETTUCE^h</code>. This variable
takes 3 values <code>batavia</code>, <code>arugula</code> and
<code>lettuce</code> the margin. The indicator <code>LETTUCE</code> here
refers to the turnover (to) of salad sales. For example, the table
<code>T10.T12.T8</code> presents the revenue from salad sales based on
the activity and category of the company, as well as the type of
salad.</p>
<p>To obtain more information about the metadata analysis, the
<code>verbose = TRUE</code> argument can be specified. This way, the
object returned by the function will be a list of the different steps of
the analysis.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">detailed_analysis</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "identify_hrc"        "info_var"            "split_in_clusters"   "create_edges"        "grp_tab_names"      </span></span>
<span><span class="co">## [6] "grp_tab_in_clusters" "tab_to_treat"        "df_tab_to_treat"</span></span></code></pre>
<p>One finds the dataframe with the cluster indicator
<code>df_tab_to_treat</code>. The result is the same but in list format:
each element of the list is an independent cluster
<code>tab_to_treat</code>. Additionally, the 6 steps of the analysis are
included.</p>
</div>
<div class="section level3">
<h3 id="case-where-the-input-is-a-eurostat-template">Case Where the Input is a Eurostat Template<a class="anchor" aria-label="anchor" href="#case-where-the-input-is-a-eurostat-template"></a>
</h3>
<p>The <code><a href="../reference/format_template.html">format_template()</a></code> function allows creating the
metadata to be used as input for <code><a href="../reference/analyse_metadata.html">analyse_metadata()</a></code> from
the Eurostat template of the published cells.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">enterprise_template</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">enterprise_template</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    3168 obs. of  5 variables:</span></span>
<span><span class="co">##  $ TIME_PERIOD: int  2022 2022 2022 2022 2022 2022 2022 2022 2022 2022 ...</span></span>
<span><span class="co">##  $ INDICATOR  : chr  "SAL" "SAL" "SAL" "SAL" ...</span></span>
<span><span class="co">##  $ ACTIVITY   : chr  "B" "B" "B" "B" ...</span></span>
<span><span class="co">##  $ NUMBER_EMPL: chr  "E0" "E1T4" "E5T9" "EGE10" ...</span></span>
<span><span class="co">##  $ LEGAL_FORM : chr  "_T" "_T" "_T" "_T" ...</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template_formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_template.html">format_template</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">enterprise_template</span>,</span>
<span>  indicator_column <span class="op">=</span> <span class="st">"INDICATOR"</span>,</span>
<span>  spanning_var_tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    ACTIVITY <span class="op">=</span> <span class="st">"BTSXO_S94"</span>,</span>
<span>    NUMBER_EMPL <span class="op">=</span> <span class="st">"_T"</span>,</span>
<span>    LEGAL_FORM <span class="op">=</span> <span class="st">"_T"</span><span class="op">)</span>,</span>
<span>  field_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TIME_PERIOD"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">template_formatted</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">##             table_name field indicator spanning_1  spanning_2   hrc_spanning_1    hrc_spanning_2</span></span>
<span><span class="co">## 1 table_2021_SAL_DTH_1  2021   SAL_DTH   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 2 table_2021_SAL_DTH_2  2021   SAL_DTH   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 3     table_2022_SAL_1  2022       SAL   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 4     table_2022_SAL_2  2022       SAL   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 5 table_2022_SAL_DTH_1  2022   SAL_DTH   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 6 table_2022_SAL_DTH_2  2022   SAL_DTH   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span></code></pre>
<p>There are 6 tables to be published.</p>
<p>Remark: <code><a href="../reference/format_template.html">format_template()</a></code> does not construct the
<code>hrc_indicator</code> column because the information contained in
the template does not allow it to be determined. Therefore, one must
create it based on the information available about the indicators.</p>
<p>Here, there is no hierarchical link between <code>SAL</code>
(employees of active companies) and <code>SAL_DTH</code> (employees in
deaths).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cas où il n'y a aucune hiérarchie sur les indicateurs</span></span>
<span><span class="va">metadata_template</span> <span class="op">&lt;-</span> <span class="va">template_formatted</span><span class="op">$</span><span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hrc_indicator <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">table_name</span>,<span class="va">field</span>,<span class="va">indicator</span>,<span class="va">hrc_indicator</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata_template</span></span></code></pre></div>
<pre><code><span><span class="co">##             table_name field indicator hrc_indicator spanning_1  spanning_2   hrc_spanning_1    hrc_spanning_2</span></span>
<span><span class="co">## 1 table_2021_SAL_DTH_1  2021   SAL_DTH            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 2 table_2021_SAL_DTH_2  2021   SAL_DTH            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 3     table_2022_SAL_1  2022       SAL            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 4     table_2022_SAL_2  2022       SAL            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 5 table_2022_SAL_DTH_1  2022   SAL_DTH            NA   ACTIVITY  LEGAL_FORM hrc_activity_131  hrc_legal_form_3</span></span>
<span><span class="co">## 6 table_2022_SAL_DTH_2  2022   SAL_DTH            NA   ACTIVITY NUMBER_EMPL hrc_activity_131 hrc_number_empl_4</span></span></code></pre>
<p>Next, this dataframe is used as input for the analysis function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyse complète, avec les étapes</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_template</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output simplifié, uniquement le dataframe avec l'indicatrice de cluster</span></span>
<span><span class="va">cluster_id_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_template</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualisation du résultat de l'analyse</span></span>
<span><span class="va">cluster_id_dataframe</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 x 8</span></span>
<span><span class="co">## # Groups:   table_name [6]</span></span>
<span><span class="co">##   cluster      table_name           field indicator spanning_1       spanning_2        hrc_spanning_1   hrc_spanning_2   </span></span>
<span><span class="co">##   &lt;chr&gt;        &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;            &lt;chr&gt;            </span></span>
<span><span class="co">## 1 2021.SAL_DTH table_2021_SAL_DTH_1 2021  SAL_DTH   HRC_ACTIVITY_131 HRC_LEGAL_FORM_3  hrc_activity_131 hrc_legal_form_3 </span></span>
<span><span class="co">## 2 2021.SAL_DTH table_2021_SAL_DTH_2 2021  SAL_DTH   HRC_ACTIVITY_131 HRC_NUMBER_EMPL_4 hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 3 2022.SAL     table_2022_SAL_1     2022  SAL       HRC_ACTIVITY_131 HRC_LEGAL_FORM_3  hrc_activity_131 hrc_legal_form_3 </span></span>
<span><span class="co">## 4 2022.SAL     table_2022_SAL_2     2022  SAL       HRC_ACTIVITY_131 HRC_NUMBER_EMPL_4 hrc_activity_131 hrc_number_empl_4</span></span>
<span><span class="co">## 5 2022.SAL_DTH table_2022_SAL_DTH_1 2022  SAL_DTH   HRC_ACTIVITY_131 HRC_LEGAL_FORM_3  hrc_activity_131 hrc_legal_form_3 </span></span>
<span><span class="co">## 6 2022.SAL_DTH table_2022_SAL_DTH_2 2022  SAL_DTH   HRC_ACTIVITY_131 HRC_NUMBER_EMPL_4 hrc_activity_131 hrc_number_empl_4</span></span></code></pre>
<p>Ultimately, there are 6 tables to process in 3 different clusters. In
other words, <code><a href="../reference/tab_multi_manager.html">tab_multi_manager()</a></code> will need to be called
three times.</p>
</div>
</div>
<div class="section level2">
<h2 id="going-further-visualizing-inclusions">Going Further: Visualizing Inclusions<a class="anchor" aria-label="anchor" href="#going-further-visualizing-inclusions"></a>
</h2>
<p>The create_edges step in the metadata analysis identifies tables
included within other tables. For example, XXXXX is included in XXXXX.
The following code allows visualizing these inclusions using graphs to
better understand the analysis procedure.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inseefrlab.github.io/rtauargus">rtauargus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://datastorm-open.github.io/visNetwork/" class="external-link">visNetwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph_links_tab</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list_desc_links</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list_desc_links</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">ss_dem</span>,<span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">ss_dem</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ss_dem</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html" class="external-link">visNetwork</a></span><span class="op">(</span>nodes <span class="op">=</span> <span class="va">nodes</span>, edges <span class="op">=</span> <span class="va">ss_dem</span>, main <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visIgraphLayout.html" class="external-link">visIgraphLayout</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html" class="external-link">visEdges</a></span><span class="op">(</span>shadow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 arrows <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">TRUE</span>, scaleFactor <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, highlight <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visOptions.html" class="external-link">visOptions</a></span><span class="op">(</span>highlightNearest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">T</span>, hover <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                   nodesIdSelection <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span><span class="op">)</span></span>
<span><span class="va">detailed_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_metadata.html">analyse_metadata</a></span><span class="op">(</span><span class="va">metadata_pizza_lettuce</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graph_links_tab</span><span class="op">(</span><span class="va">detailed_analysis</span><span class="op">$</span><span class="va">create_edges</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $france_entreprises_2023.hrc_lettuce</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $france_entreprises_2023.to_pizza</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pierre-Yves Berrard, Julien Jamme, Nathanaël Rastout, Jeanne Pointet, Félix Beroud, André-Raymond Socard, Wistan Pomel, Clara Baudry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
